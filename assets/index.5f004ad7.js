var e=Object.defineProperty,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,o=(e,o)=>{for(var a in o||(o={}))r.call(o,a)&&n(e,a,o[a]);if(t)for(var a of t(o))s.call(o,a)&&n(e,a,o[a]);return e};import{a,v as u,s as l,l as i,t as c,b as f,i as p,r as h,w as v,o as d,c as y,d as x,u as m,e as g,F as b,f as A,g as P,h as C,p as w,P as k,j as _}from"./vendor.4481e40c.js";class S extends Error{constructor(e,t){super(e),this.info=t,Error.captureStackTrace&&Error.captureStackTrace(this,S)}}var j=Object.defineProperty,M=Object.getOwnPropertyDescriptor,O=(e,t,r,s)=>{for(var n,o=s>1?void 0:s?M(t,r):t,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s?n(t,r,o):n(o))||o);return s&&o&&j(t,r,o),o};const E=class{constructor(e=[],t,r){this.opts={},this.layerdStates=e,this.parent=t,this.name=r||(1===e.length?"<root>":"<anonymous>")}log(e,t){this.parent?this.parent.log(e,t):this.opts.log&&this.opts.log(e,t)}onUpdated(e,t){this.parent?this.parent.onUpdated(e,t):this.opts.onUpdated&&this.opts.onUpdated(e,t)}createChildScope(e=new Map,t){const r=[e,...this.layerdStates];return new E(r,this,t)}get(e){for(const t of this.layerdStates)if(t.has(e)){const r=t.get(e);return this.log("read",{var:e,val:r}),r}throw new S(`No such variable '${e}' in scope '${this.name}'`,{scope:this.layerdStates})}add(e,t){if(this.log("add",{var:e,val:t}),this.layerdStates[0].has(e))throw new S(`Variable '${e}' is alerady exists in scope '${this.name}'`,{scope:this.layerdStates});this.layerdStates[0].set(e,t),null==this.parent&&this.onUpdated(e,t)}assign(e,t){let r=1;for(const s of this.layerdStates){if(s.has(e))return s.set(e,t),this.log("assign",{var:e,val:t}),void(r===this.layerdStates.length&&this.onUpdated(e,t));r++}throw new S(`No such variable '${e}' in scope '${this.name}'`,{scope:this.layerdStates})}};let $=E;O([a],$.prototype,"log",1),O([a],$.prototype,"onUpdated",1),O([a],$.prototype,"createChildScope",1),O([a],$.prototype,"get",1),O([a],$.prototype,"add",1),O([a],$.prototype,"assign",1);const N={type:"null"},D={type:"bool",value:!0},H={type:"bool",value:!1},I=e=>({type:"num",value:e}),q=e=>({type:"str",value:e}),F=e=>({type:"bool",value:e}),z=e=>({type:"obj",value:e}),U=e=>({type:"arr",value:e}),R=e=>({type:"fn",native:e});function T(e){if("bool"!==e.type)throw new S(`Expect boolean, but got ${e.type}.`)}function J(e){if("fn"!==e.type)throw new S(`Expect function, but got ${e.type}.`)}function Z(e){if("str"!==e.type)throw new S(`Expect string, but got ${e.type}.`)}function B(e){if("num"!==e.type)throw new S(`Expect number, but got ${e.type}.`)}function V(e){if("obj"!==e.type)throw new S(`Expect object, but got ${e.type}.`)}function L(e){if("arr"!==e.type)throw new S(`Expect array, but got ${e.type}.`)}function Y(e,t){return"fn"!==e.type&&"fn"!==t.type&&("null"===e.type&&"null"===t.type||"null"!==e.type&&"null"!==t.type&&e.value===t.value)}function G(e,t=!1){if(t){if("num"===e.type)return e.value;if("bool"===e.type)return e.value?"yes":"no";if("str"===e.type)return`"${e.value}"`;if("arr"===e.type)return`[${e.value.map((e=>G(e,!0))).join(", ")}]`;if("null"===e.type)return"(null)"}const r="num"===e.type||"bool"===e.type?e.value:"str"===e.type?`"${e.value}"`:"fn"===e.type||"obj"===e.type?"...":"null"===e.type?"":null;return`${e.type}<${r}>`}function K(e){switch(e.type){case"arr":return e.value.map((e=>K(e)));case"bool":return e.value;case"null":return null;case"num":return e.value;case"obj":{const t={};for(const[r,s]of e.value.entries())t[r]=K(s);return t}case"str":return e.value;default:return}}function Q(e){if(null===e)return N;if("boolean"==typeof e)return F(e);if("string"==typeof e)return q(e);if("number"==typeof e)return I(e);if(Array.isArray(e))return U(e.map((e=>Q(e))));if("object"==typeof e){const t=new Map;for(const[r,s]of Object.entries(e))t.set(r,Q(s));return z(t)}return N}const W={help:q("SEE: https://github.com/syuilo/aiscript/blob/master/docs/get-started.md"),"Core:v":q("0.11.1"),"Core:ai":q("kawaii"),"Core:not":R((([e])=>(T(e),e.value?H:D))),"Core:eq":R((([e,t])=>Y(e,t)?D:H)),"Core:neq":R((([e,t])=>Y(e,t)?H:D)),"Core:and":R((([e,t])=>(T(e),T(t),e.value&&t.value?D:H))),"Core:or":R((([e,t])=>(T(e),T(t),e.value||t.value?D:H))),"Core:add":R((([e,t])=>(B(e),B(t),I(e.value+t.value)))),"Core:sub":R((([e,t])=>(B(e),B(t),I(e.value-t.value)))),"Core:mul":R((([e,t])=>(B(e),B(t),I(e.value*t.value)))),"Core:div":R((([e,t])=>{B(e),B(t);const r=e.value/t.value;if(isNaN(r))throw new S("Invalid operation.");return I(r)})),"Core:mod":R((([e,t])=>(B(e),B(t),I(e.value%t.value)))),"Core:gt":R((([e,t])=>(B(e),B(t),e.value>t.value?D:H))),"Core:lt":R((([e,t])=>(B(e),B(t),e.value<t.value?D:H))),"Core:gteq":R((([e,t])=>(B(e),B(t),e.value>=t.value?D:H))),"Core:lteq":R((([e,t])=>(B(e),B(t),e.value<=t.value?D:H))),"Core:type":R((([e])=>q(e.type))),"Core:to_str":R((([e])=>"str"===e.type?e:"num"===e.type?q(e.value.toString()):q("?"))),"Core:range":R((([e,t])=>(B(e),B(t),e.value<t.value?U(Array.from({length:t.value-e.value+1},((t,r)=>I(r+e.value)))):e.value>t.value?U(Array.from({length:e.value-t.value+1},((t,r)=>I(e.value-r)))):U([e])))),"Util:uuid":R((()=>q(u()))),"Json:stringify":R((([e])=>q(JSON.stringify(K(e))))),"Json:parse":R((([e])=>(Z(e),Q(JSON.parse(e.value))))),"Date:now":R((()=>I(Date.now()))),"Date:year":R((()=>I((new Date).getFullYear()))),"Date:month":R((()=>I((new Date).getMonth()+1))),"Date:day":R((()=>I((new Date).getDate()))),"Date:hour":R((()=>I((new Date).getHours()))),"Date:minute":R((()=>I((new Date).getMinutes()))),"Date:second":R((()=>I((new Date).getSeconds()))),"Date:parse":R((([e])=>(Z(e),I(new Date(e.value).getTime())))),"Math:PI":I(Math.PI),"Math:sin":R((([e])=>(B(e),I(Math.sin(e.value))))),"Math:cos":R((([e])=>(B(e),I(Math.cos(e.value))))),"Math:abs":R((([e])=>(B(e),I(Math.abs(e.value))))),"Math:sqrt":R((([e])=>{B(e);const t=Math.sqrt(e.value);if(isNaN(t))throw new S("Invalid operation.");return I(t)})),"Math:round":R((([e])=>(B(e),I(Math.round(e.value))))),"Math:floor":R((([e])=>(B(e),I(Math.floor(e.value))))),"Math:min":R((([e,t])=>(B(e),B(t),I(Math.min(e.value,t.value))))),"Math:max":R((([e,t])=>(B(e),B(t),I(Math.max(e.value,t.value))))),"Math:rnd":R((([e,t])=>e&&"num"===e.type&&t&&"num"===t.type?I(Math.floor(Math.random()*(t.value-e.value+1)+e.value)):I(Math.random()))),"Math:gen_rng":R((([e])=>{if("num"!==e.type&&"str"!==e.type)return N;const t=l(e.value.toString());return R((([e,r])=>e&&"num"===e.type&&r&&"num"===r.type?I(Math.floor(t()*(r.value-e.value+1)+e.value)):I(t())))})),"Num:to_hex":R((([e])=>(B(e),q(e.value.toString(16))))),"Num:from_hex":R((([e])=>(Z(e),I(parseInt(e.value,16))))),"Str:lf":q("\n"),"Str:to_num":R((([e])=>{if("num"===e.type)return e;if("str"===e.type){const t=parseInt(e.value,10);return isNaN(t)?N:I(t)}return N})),"Str:len":R((([e])=>"str"!==e.type?I(0):I(i(e.value)))),"Str:pick":R((([e,t])=>{Z(e),B(t);const r=c(e.value)[t.value-1];return r?q(r):N})),"Str:incl":R((([e,t])=>(Z(e),Z(t),e.value.includes(t.value)?D:H))),"Str:slice":R((([e,t,r])=>(Z(e),B(t),B(r),q(f(e.value,t.value-1,r.value-1))))),"Str:split":R((([e,t])=>(Z(e),t&&Z(t),U(t?e.value.split(t?t.value:"").map((e=>q(e))):c(e.value).map((e=>q(e))))))),"Str:replace":R((([e,t,r])=>(Z(e),Z(t),Z(r),q(e.value.split(t.value).join(r.value))))),"Str:index_of":R((([e,t])=>(Z(e),Z(t),I(p(e.value,t.value)+1)))),"Str:trim":R((([e])=>(Z(e),q(e.value.trim())))),"Str:upper":R((([e])=>(Z(e),q(e.value.toUpperCase())))),"Str:lower":R((([e])=>(Z(e),q(e.value.toLowerCase())))),"Arr:len":R((([e])=>"arr"!==e.type?I(0):I(e.value.length))),"Arr:push":R((([e,t])=>(L(e),e.value.push(t),N))),"Arr:unshift":R((([e,t])=>(L(e),e.value.unshift(t),N))),"Arr:pop":R((([e])=>(L(e),e.value.pop()))),"Arr:shift":R((([e])=>(L(e),e.value.shift()))),"Arr:concat":R((([e,t])=>(L(e),L(t),U(e.value.concat(t.value))))),"Arr:join":R((([e,t])=>(L(e),t&&Z(t),q(e.value.map((e=>"str"===e.type?e.value:"")).join(t?t.value:""))))),"Arr:slice":R((([e,t,r])=>(L(e),B(t),B(r),U(e.value.slice(t.value-1,r.value-1))))),"Arr:incl":R((([e,t])=>{if(L(e),"str"!==t.type&&"num"!==t.type&&"bool"!==t.type&&"null"!==t.type)return H;return(r=e,r.value.map((e=>"str"===e.type||"num"===e.type||"bool"===e.type?e.value:"null"===e.type?null:Symbol()))).includes("null"===t.type?null:t.value)?D:H;var r})),"Arr:map":R((async([e,t],r)=>{L(e),J(t);const s=e.value.map((async(e,s)=>await r.call(t,[e,I(s+1)])));return U(await Promise.all(s))})),"Arr:filter":R((async([e,t],r)=>{L(e),J(t);const s=[];for(let n=0;n<e.value.length;n++){const o=e.value[n],a=await r.call(t,[o,I(n+1)]);T(a),a.value&&s.push(o)}return U(s)})),"Arr:reduce":R((async([e,t,r],s)=>{L(e),J(t);const n=null!=r;let o=n?r:e.value[0];for(let a=n?0:1;a<e.value.length;a++){const r=e.value[a];o=await s.call(t,[o,r,I(a+1)])}return o})),"Arr:find":R((async([e,t],r)=>{L(e),J(t);for(let s=0;s<e.value.length;s++){const n=e.value[s],o=await r.call(t,[n,I(s+1)]);if(T(o),o.value)return n}return N})),"Arr:reverse":R((([e])=>(L(e),e.value.reverse(),N))),"Arr:copy":R((async([e])=>(L(e),U([...e.value])))),"Obj:keys":R((([e])=>(V(e),U(Array.from(e.value.keys()).map((e=>q(e))))))),"Obj:kvs":R((([e])=>(V(e),U(Array.from(e.value.entries()).map((([e,t])=>U([q(e),t]))))))),"Obj:get":R((([e,t])=>(V(e),Z(t),e.value.get(t.value)||N))),"Obj:set":R((([e,t,r])=>(V(e),Z(t),e.value.set(t.value,r),N))),"Obj:has":R((([e,t])=>(V(e),Z(t),F(e.value.has(t.value))))),"Obj:copy":R((([e])=>(V(e),z(new Map(e.value))))),"Async:interval":R((async([e,t,r],s)=>{B(e),J(t),r&&T(r),r&&s.call(t,[]);const n=setInterval((()=>{s.call(t,[])}),e.value),o=()=>{clearInterval(n)};return s.registerAbortHandler(o),R((([],e)=>{clearInterval(n),e.unregisterAbortHandler(o)}))})),"Async:timeout":R((async([e,t],r)=>{B(e),J(t);const s=setTimeout((()=>{r.call(t,[])}),e.value),n=()=>{clearTimeout(s)};return r.registerAbortHandler(n),R((([],e)=>{clearTimeout(s),e.unregisterAbortHandler(n)}))}))};function X(e){switch(e.op){case"+":return{func:"Core:add",prec:6,loc:e.loc};case"-":return{func:"Core:sub",prec:6,loc:e.loc};case"*":return{func:"Core:mul",prec:7,loc:e.loc};case"/":return{func:"Core:div",prec:7,loc:e.loc};case"%":return{func:"Core:mod",prec:7,loc:e.loc};case"=":return{func:"Core:eq",prec:4,loc:e.loc};case"!=":return{func:"Core:neq",prec:4,loc:e.loc};case"&":return{func:"Core:and",prec:3,loc:e.loc};case"|":return{func:"Core:or",prec:2,loc:e.loc};case"<":return{func:"Core:lt",prec:4,loc:e.loc};case">":return{func:"Core:gt",prec:4,loc:e.loc};case"<=":return{func:"Core:lteq",prec:4,loc:e.loc};case">=":return{func:"Core:gteq",prec:4,loc:e.loc};default:throw new S(`No such operator: ${e.op}.`)}}function ee(e,t,r){return{opInfo:e,lchild:t,rchild:r,type:"infixtree"}}function te(e,t,r){if("infixtree"!==e.type)return ee(t,e,r);if(e.opInfo.prec>=t.prec)return ee(t,e,r);{const{opInfo:s,lchild:n,rchild:o}=e;return ee(s,n,te(o,t,r))}}function re(e){return"infixtree"!==e.type?e:{type:"call",loc:e.opInfo.loc,name:e.opInfo.func,args:[re(e.lchild),re(e.rchild)]}}function se(e){const t=e.operators.map(X),r=e.operands;let s=ee(t[0],r[0],r[1]);for(let n=1;n<t.length;n++)s=te(s,t[n],r[n+1]);return re(s)}var ne=Object.defineProperty,oe=Object.getOwnPropertyDescriptor,ae=(e,t,r,s)=>{for(var n,o=s>1?void 0:s?oe(t,r):t,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s?n(t,r,o):n(o))||o);return s&&o&&ne(t,r,o),o};class ue{constructor(e,t){this.stepCount=0,this.stop=!1,this.abortHandlers=[],this.opts=t||{};const r={print:R((e=>{this.opts.out&&this.opts.out(e[0])})),readline:R((async e=>{const t=e[0];if(Z(t),null==this.opts.in)return N;const r=await this.opts.in(t.value);return q(r)}))};this.vars=o(o(o({},e),W),r),this.scope=new $([new Map(Object.entries(this.vars))]),this.scope.opts.log=(e,t)=>{switch(e){case"add":this.log("var:add",t);break;case"read":this.log("var:read",t);break;case"write":this.log("var:write",t)}}}async exec(e){if(null==e||0===e.length)return;await this.collectNs(e);const t=await this._run(e,this.scope);this.log("end",{val:t})}async execFn(e,t){return this._fn(e,t)}static collectMetadata(e){if(null==e||0===e.length)return;function t(e){switch(e.type){case"arr":return e.value.map((e=>t(e)));case"bool":return e.value;case"null":return null;case"num":return e.value;case"obj":{const r={};for(const[s,n]of e.value.entries())r[s]=t(n);return r}case"str":return e.value}}const r=new Map;for(const s of e)switch(s.type){case"meta":r.set(s.name,t(s.value))}return r}log(e,t){this.opts.log&&this.opts.log(e,t)}async collectNs(e){for(const t of e)switch(t.type){case"ns":await this.collectNsMember(t)}}async collectNsMember(e){const t=this.scope.createChildScope();for(const r of e.members)switch(r.type){case"def":{const s=await this._eval(r.expr,t);t.add(r.name,s),this.scope.add(e.name+":"+r.name,s);break}case"ns":break;default:throw new Error("invalid ns member type: "+r.type)}}async _fn(e,t){if(e.native){return await Promise.resolve(e.native(t,{call:this._fn,registerAbortHandler:this.registerAbortHandler,unregisterAbortHandler:this.unregisterAbortHandler}))||N}{const s=new Map;for(let r=0;r<(e.args||[]).length;r++)s.set(e.args[r],t[r]);const n=e.scope.createChildScope(s);return"return"===(r=await this._run(e.statements,n)).type?r.value:r}var r}async _eval(e,t){if(this.stop)return N;if(this.log("node",{node:e}),this.stepCount++,this.opts.maxStep&&this.stepCount>this.opts.maxStep)throw new S("max step exceeded");switch(e.type){case"call":{const r=t.get(e.name);J(r);const s=await Promise.all(e.args.map((async e=>await this._eval(e,t))));return this._fn(r,s)}case"if":{const r=await this._eval(e.cond,t);if(T(r),r.value)return this._eval(e.then,t);if(e.elseif&&e.elseif.length>0){for(const r of e.elseif){const e=await this._eval(r.cond,t);if(T(e),e.value)return this._eval(r.then,t)}if(e.else)return this._eval(e.else,t)}else if(e.else)return this._eval(e.else,t);return N}case"match":{const r=await this._eval(e.about,t);for(const s of e.qs){if(Y(r,await this._eval(s.q,t)))return await this._eval(s.a,t)}return e.default?await this._eval(e.default,t):N}case"loop":for(;;){if("break"===(await this._run(e.statements,t.createChildScope())).type)break}return N;case"for":if(e.times){const r=await this._eval(e.times,t);B(r);for(let s=1;s<r.value+1;s++){if("break"===(await this._eval(e.for,t)).type)break}}else{const r=await this._eval(e.from,t),s=await this._eval(e.to,t);B(r),B(s);for(let n=r.value+1;n<s.value+1;n++){if("break"===(await this._eval(e.for,t.createChildScope(new Map([[e.var,I(n)]])))).type)break}}return N;case"forOf":{const r=await this._eval(e.items,t);L(r);for(const s of r.value)await this._eval(e.for,t.createChildScope(new Map([[e.var,s]])));return N}case"def":return t.add(e.name,await this._eval(e.expr,t)),N;case"var":return t.get(e.name);case"assign":return t.assign(e.name,await this._eval(e.expr,t)),N;case"propAssign":{let r=t.get(e.obj);const s=e.path[e.path.length-1];for(const t of e.path.slice(0,e.path.length-1)){if(V(r),!r.value.has(t)){r=N;break}r=r.value.get(t)}return V(r),r.value.set(s,await this._eval(e.expr,t)),N}case"indexAssign":{const r=t.get(e.arr);L(r);const s=await this._eval(e.i,t);return B(s),r.value[s.value-1]=await this._eval(e.expr,t),N}case"inc":{const r=t.get(e.name);B(r);const s=await this._eval(e.expr,t);return B(s),r.value+=s.value,N}case"dec":{const r=t.get(e.name);B(r);const s=await this._eval(e.expr,t);return B(s),r.value-=s.value,N}case"null":return N;case"bool":return F(e.value);case"num":return I(e.value);case"str":return q(e.value);case"arr":return U(await Promise.all(e.value.map((async e=>await this._eval(e,t)))));case"obj":{const r=new Map;for(const s of e.value.keys())r.set(s,await this._eval(e.value.get(s),t));return z(r)}case"prop":{let r=t.get(e.obj);for(const t of e.path){if(V(r),!r.value.has(t)){r=N;break}r=r.value.get(t)}return r}case"propCall":{let r=t.get(e.obj);for(const t of e.path){if(V(r),!r.value.has(t)){r=N;break}r=r.value.get(t)}J(r);const s=await Promise.all(e.args.map((async e=>await this._eval(e,t))));return this._fn(r,s)}case"index":{const r=t.get(e.arr);L(r);const s=await this._eval(e.i,t);return B(s),r.value[s.value-1]}case"fn":return((e,t,r)=>({type:"fn",args:e,statements:t,scope:r}))(e.args,e.children,t);case"block":return this._run(e.statements,t.createChildScope());case"tmpl":{let r="";for(const s of e.tmpl)if("string"==typeof s)r+=s;else{const e=await this._eval(s,t);let n="";"str"===e.type?n=e.value:"num"===e.type&&(n=e.value.toString()),r+=n}return q(r)}case"infix":return this._eval(se(e),t);case"return":{const r=await this._eval(e.expr,t);return this.log("block:return",{scope:t.name,val:r}),{type:"return",value:r}}case"break":return this.log("block:break",{scope:t.name}),{type:"break",value:null};case"continue":return this.log("block:continue",{scope:t.name}),{type:"continue",value:null};case"ns":case"meta":return N;default:throw new Error("invalid node type")}}async _run(e,t){this.log("block:enter",{scope:t.name});let r=N;for(let s=0;s<e.length;s++){const n=e[s];if(r=await this._eval(n,t),"return"===r.type)return this.log("block:return",{scope:t.name,val:r.value}),r;if("break"===r.type)return this.log("block:break",{scope:t.name}),r;if("continue"===r.type)return this.log("block:continue",{scope:t.name}),r}return this.log("block:leave",{scope:t.name,val:r}),r}registerAbortHandler(e){this.abortHandlers.push(e)}unregisterAbortHandler(e){this.abortHandlers=this.abortHandlers.filter((t=>t!=e))}abort(){this.stop=!0;for(const e of this.abortHandlers)e();this.abortHandlers=[]}}function le(e,t,r,s){var n=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(n,le.prototype),n.expected=t,n.found=r,n.location=s,n.name="SyntaxError",n}function ie(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}function ce(e,t){var r,s,n,o,a={},u=(t=void 0!==t?t:{}).grammarSource,l={Entry:Jt,Core:function(){var e,t,r,s,n,o=70*Ot+3,u=It[o];if(u)return Ot=u.nextPos,u.result;e=Ot,t=[],r=mr();for(;r!==a;)t.push(r),r=mr();(r=Bt())===a&&(r=null);s=[],n=mr();for(;n!==a;)s.push(n),n=mr();return Et=e,e=vt(r),It[o]={nextPos:Ot,result:e},e}},i=Jt,c="//",f="(",p=")",h="{",v="}",d="###",y="#",x="=",m="<-",g="<:",b="<<<",A="#[",P="]",C="each",w=",",k="for",_="return",S="loop",j="break",M="continue",O=".",E="[",$="+<-",N="-<-",D="=>",H="if",I="elif",q="else",F="match",z="`",U="\\{",R="\\}",T="\\`",J='"',Z="yes",B="no",V="null",L=":",Y=";",G="@(",K=/^[A-Z0-9_:]/i,Q=/^[\-+*\/%&|=~<>!?]/,W=/^[+\-]/,X=/^[1-9]/,ee=/^[0-9]/,te=/^[A-Z_]/i,re=/^[A-Z0-9_]/i,se=/^[\r\n]/,ne=/^[ \t\r\n]/,oe=/^[ \t]/,ae={type:"any"},ue=Ft("//",!1),ie=Ft("(",!1),fe=Ft(")",!1),pe=Ft("::",!1),he=Ft("{",!1),ve=Ft("}",!1),de=Ft("###",!1),ye=Ft("#",!1),xe=Ft("=",!1),me=Ft("$",!1),ge=Ft("<-",!1),be=Ft("<:",!1),Ae=Ft("<<<",!1),Pe=Ft("#[",!1),Ce=Ft("]",!1),we=Ft("each",!1),ke=Ft(",",!1),_e=Ft("for",!1),Se=Ft("return",!1),je=Ft("loop",!1),Me=Ft("break",!1),Oe=zt([["A","Z"],["0","9"],"_",":"],!1,!0),Ee=Ft("continue",!1),$e=Ft(".",!1),Ne=Ft("[",!1),De=Ft("+<-",!1),He=Ft("-<-",!1),Ie=Ft("\\",!1),qe=Ft("=>",!1),Fe=zt(["-","+","*","/","%","&","|","=","~","<",">","!","?"],!1,!1),ze=Ft("if",!1),Ue=Ft("elif",!1),Re=Ft("else",!1),Te=Ft("match",!1),Je=Ft("*",!1),Ze=Ft("`",!1),Be=Ft("\\{",!1),Ve=Ft("\\}",!1),Le=Ft("\\`",!1),Ye=Ft('"',!1),Ge=Ft('\\"',!1),Ke=zt(["+","-"],!1,!1),Qe=zt([["1","9"]],!1,!1),We=zt([["0","9"]],!1,!1),Xe=Ft("yes",!1),et=Ft("no",!1),tt=Ft("null",!1),rt=Ft(":",!1),st=Ft(";",!1),nt=Ft("@",!1),ot=Ft("@(",!1),at=zt([["A","Z"],"_"],!1,!0),ut=zt([["A","Z"],["0","9"],"_"],!1,!0),lt=Ft("\r\n",!1),it=zt(["\r","\n"],!1,!1),ct=zt([" ","\t","\r","\n"],!1,!1),ft=zt([" ","\t"],!1,!1),pt=function(e){return ce(e.join(""),(t="Core")?{startRule:t}:{});var t},ht=function(){return qt()},vt=function(e){return e||[]},dt=function(e,t){return t},yt=function(e,t){return[e,...t]},xt=function(e,t,r){return Ar("forOf",{var:e,items:t,for:r})},mt=function(e,t){return t},gt=function(e,t,r,s){return Ar("for",{var:e,from:t||Ar("num",{value:0}),to:r,for:s})},bt=function(e,t){return Ar("for",{times:e,for:t})},At=function(e,t){return t},Pt=function(e,t,r){return{o:t,t:r}},Ct=function(e,t,r){return{q:t,a:r}},wt=function(e,t){return t},kt=function(){return qt()[1]},_t=function(){return Ar("num",{value:parseInt(qt(),10)})},St=function(e,t){return{k:e,v:t}},jt=function(e){const t=new Map;for(const r of e)t.set(r.k,r.v);return Ar("obj",{value:t})},Mt=function(e){return Ar("arr",{value:e})},Ot=0,Et=0,$t=[{line:1,column:1}],Nt=0,Dt=[],Ht=0,It={};if("startRule"in t){if(!(t.startRule in l))throw new Error("Can't start parsing from rule \""+t.startRule+'".');i=l[t.startRule]}function qt(){return e.substring(Et,Ot)}function Ft(e,t){return{type:"literal",text:e,ignoreCase:t}}function zt(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Ut(t){var r,s=$t[t];if(s)return s;for(r=t-1;!$t[r];)r--;for(s={line:(s=$t[r]).line,column:s.column};r<t;)10===e.charCodeAt(r)?(s.line++,s.column=1):s.column++,r++;return $t[t]=s,s}function Rt(e,t){var r=Ut(e),s=Ut(t);return{source:u,start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:s.line,column:s.column}}}function Tt(e){Ot<Nt||(Ot>Nt&&(Nt=Ot,Dt=[]),Dt.push(e))}function Jt(){var e,t,r,s=70*Ot+0,n=It[s];if(n)return Ot=n.nextPos,n.result;for(e=Ot,t=[],r=Zt();r!==a;)t.push(r),r=Zt();return Et=e,e=t=pt(t),It[s]={nextPos:Ot,result:e},e}function Zt(){var t,r,s=70*Ot+1,n=It[s];return n?(Ot=n.nextPos,n.result):(t=Ot,(r=or())!==a&&(Et=t,r=ht()),(t=r)===a&&(t=Ot,(r=ur())!==a&&(Et=t,r=ht()),(t=r)===a&&(t=Ot,(r=function(){var t,r,s,n,o,u,l=70*Ot+2,i=It[l];if(i)return Ot=i.nextPos,i.result;t=Ot,e.substr(Ot,2)===c?(r=c,Ot+=2):(r=a,0===Ht&&Tt(ue));if(r!==a){for(s=[],n=Ot,o=Ot,Ht++,u=xr(),Ht--,u===a?o=void 0:(Ot=o,o=a),o!==a?(e.length>Ot?(u=e.charAt(Ot),Ot++):(u=a,0===Ht&&Tt(ae)),u!==a?n=o=[o,u]:(Ot=n,n=a)):(Ot=n,n=a);n!==a;)s.push(n),n=Ot,o=Ot,Ht++,u=xr(),Ht--,u===a?o=void 0:(Ot=o,o=a),o!==a?(e.length>Ot?(u=e.charAt(Ot),Ot++):(u=a,0===Ht&&Tt(ae)),u!==a?n=o=[o,u]:(Ot=n,n=a)):(Ot=n,n=a);t=r=[r,s]}else Ot=t,t=a;return It[l]={nextPos:Ot,result:t},t}())!==a&&(Et=t,r=""),(t=r)===a&&(e.length>Ot?(t=e.charAt(Ot),Ot++):(t=a,0===Ht&&Tt(ae))))),It[s]={nextPos:Ot,result:t},t)}function Bt(){var e,t,r,s,n,o,u,l,i=70*Ot+4,c=It[i];if(c)return Ot=c.nextPos,c.result;if(e=Ot,(t=Lt())!==a){for(r=[],s=Ot,n=[],o=gr();o!==a;)n.push(o),o=gr();if((o=yr())!==a){for(u=[],l=mr();l!==a;)u.push(l),l=mr();(l=Lt())!==a?(Et=s,s=dt(0,l)):(Ot=s,s=a)}else Ot=s,s=a;for(;s!==a;){for(r.push(s),s=Ot,n=[],o=gr();o!==a;)n.push(o),o=gr();if((o=yr())!==a){for(u=[],l=mr();l!==a;)u.push(l),l=mr();(l=Lt())!==a?(Et=s,s=dt(0,l)):(Ot=s,s=a)}else Ot=s,s=a}Et=e,e=yt(t,r)}else Ot=e,e=a;return It[i]={nextPos:Ot,result:e},e}function Vt(){var e,t,r,s,n,o,u,l,i=70*Ot+6,c=It[i];if(c)return Ot=c.nextPos,c.result;if(e=Ot,(t=Gt())!==a){for(r=[],s=Ot,n=[],o=gr();o!==a;)n.push(o),o=gr();if((o=yr())!==a){for(u=[],l=mr();l!==a;)u.push(l),l=mr();(l=Gt())!==a?(Et=s,s=dt(0,l)):(Ot=s,s=a)}else Ot=s,s=a;for(;s!==a;){for(r.push(s),s=Ot,n=[],o=gr();o!==a;)n.push(o),o=gr();if((o=yr())!==a){for(u=[],l=mr();l!==a;)u.push(l),l=mr();(l=Gt())!==a?(Et=s,s=dt(0,l)):(Ot=s,s=a)}else Ot=s,s=a}Et=e,e=yt(t,r)}else Ot=e,e=a;return It[i]={nextPos:Ot,result:e},e}function Lt(){var t,r=70*Ot+7,s=It[r];return s?(Ot=s.nextPos,s.result):((t=Xt())===a&&(t=function(){var t,r,s,n,o,u,l=70*Ot+15,i=It[l];if(i)return Ot=i.nextPos,i.result;t=Ot,e.substr(Ot,3)===d?(r=d,Ot+=3):(r=a,0===Ht&&Tt(de));if(r!==a){for(s=[],n=gr();n!==a;)s.push(n),n=gr();if((n=vr())!==a){for(o=[],u=mr();u!==a;)o.push(u),u=mr();(u=Wt())!==a?(Et=t,t=Ar("meta",{name:n,value:u})):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a;if(t===a)if(t=Ot,e.substr(Ot,3)===d?(r=d,Ot+=3):(r=a,0===Ht&&Tt(de)),r!==a){for(s=[],n=gr();n!==a;)s.push(n),n=gr();(n=Wt())!==a?(Et=t,t=function(e){return Ar("meta",{name:null,value:e})}(n)):(Ot=t,t=a)}else Ot=t,t=a;return It[l]={nextPos:Ot,result:t},t}())===a&&(t=Gt()),It[r]={nextPos:Ot,result:t},t)}function Yt(){var e,t=70*Ot+8,r=It[t];return r?(Ot=r.nextPos,r.result):((e=er())===a&&(e=hr())===a&&(e=Xt()),It[t]={nextPos:Ot,result:e},e)}function Gt(){var t,r=70*Ot+9,s=It[r];return s?(Ot=s.nextPos,s.result):((t=er())===a&&(t=hr())===a&&(t=function(){var t,r,s,n,o=70*Ot+17,u=It[o];if(u)return Ot=u.nextPos,u.result;t=Ot,e.substr(Ot,2)===g?(r=g,Ot+=2):(r=a,0===Ht&&Tt(be));if(r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();(n=Kt())!==a?(Et=t,t=Ar("call",{name:"print",args:[n]})):(Ot=t,t=a)}else Ot=t,t=a;return It[o]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o=70*Ot+18,u=It[o];if(u)return Ot=u.nextPos,u.result;t=Ot,e.substr(Ot,3)===b?(r=b,Ot+=3):(r=a,0===Ht&&Tt(Ae));if(r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();(n=Kt())!==a?(Et=t,t=Ar("debug",{expr:n})):(Ot=t,t=a)}else Ot=t,t=a;return It[o]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o=70*Ot+22,u=It[o];if(u)return Ot=u.nextPos,u.result;t=Ot,e.substr(Ot,6)===_?(r=_,Ot+=6):(r=a,0===Ht&&Tt(Se));if(r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();(n=Kt())!==a?(Et=t,t=Ar("return",{expr:n})):(Ot=t,t=a)}else Ot=t,t=a;return It[o]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l,i,c=70*Ot+19,f=It[c];if(f)return Ot=f.nextPos,f.result;t=Ot,e.substr(Ot,2)===A?(r=A,Ot+=2):(r=a,0===Ht&&Tt(Pe));if(r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if((n=vr())!==a){for(o=[],u=mr();u!==a;)o.push(u),u=mr();if((u=Wt())!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();93===e.charCodeAt(Ot)?(i=P,Ot++):(i=a,0===Ht&&Tt(Ce)),i!==a?(Et=t,t=Ar("attr",{name:n,value:u})):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a}else Ot=t,t=a;return It[c]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l,i,c,h,v,d,x,m=70*Ot+20,g=It[m];if(g)return Ot=g.nextPos,g.result;t=Ot,e.substr(Ot,4)===C?(r=C,Ot+=4):(r=a,0===Ht&&Tt(we));if(r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if(40===e.charCodeAt(Ot)?(n=f,Ot++):(n=a,0===Ht&&Tt(ie)),n!==a)if(35===e.charCodeAt(Ot)?(o=y,Ot++):(o=a,0===Ht&&Tt(ye)),o!==a)if((u=vr())!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();for(44===e.charCodeAt(Ot)?(i=w,Ot++):(i=a,0===Ht&&Tt(ke)),i===a&&(i=null),c=[],h=mr();h!==a;)c.push(h),h=mr();if((h=Kt())!==a)if(41===e.charCodeAt(Ot)?(v=p,Ot++):(v=a,0===Ht&&Tt(fe)),v!==a){for(d=[],x=mr();x!==a;)d.push(x),x=mr();(x=Gt())!==a?(Et=t,t=xt(u,h,x)):(Ot=t,t=a)}else Ot=t,t=a;else Ot=t,t=a}else Ot=t,t=a;else Ot=t,t=a;else Ot=t,t=a}else Ot=t,t=a;if(t===a)if(t=Ot,e.substr(Ot,4)===C?(r=C,Ot+=4):(r=a,0===Ht&&Tt(we)),r!==a){if(s=[],(n=mr())!==a)for(;n!==a;)s.push(n),n=mr();else s=a;if(s!==a)if(35===e.charCodeAt(Ot)?(n=y,Ot++):(n=a,0===Ht&&Tt(ye)),n!==a)if((o=vr())!==a){for(u=[],l=mr();l!==a;)u.push(l),l=mr();for(44===e.charCodeAt(Ot)?(l=w,Ot++):(l=a,0===Ht&&Tt(ke)),l===a&&(l=null),i=[],c=mr();c!==a;)i.push(c),c=mr();if((c=Kt())!==a){if(h=[],(v=mr())!==a)for(;v!==a;)h.push(v),v=mr();else h=a;h!==a&&(v=Gt())!==a?(Et=t,t=xt(o,c,v)):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a;else Ot=t,t=a;else Ot=t,t=a}else Ot=t,t=a;return It[m]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l,i,c,h,v,d,m,g,b=70*Ot+21,A=It[b];if(A)return Ot=A.nextPos,A.result;t=Ot,e.substr(Ot,3)===k?(r=k,Ot+=3):(r=a,0===Ht&&Tt(_e));if(r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if(40===e.charCodeAt(Ot)?(n=f,Ot++):(n=a,0===Ht&&Tt(ie)),n!==a)if(35===e.charCodeAt(Ot)?(o=y,Ot++):(o=a,0===Ht&&Tt(ye)),o!==a)if((u=vr())!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();if(i=Ot,61===e.charCodeAt(Ot)?(c=x,Ot++):(c=a,0===Ht&&Tt(xe)),c!==a){for(h=[],v=mr();v!==a;)h.push(v),v=mr();(v=Kt())!==a?(Et=i,i=mt(0,v)):(Ot=i,i=a)}else Ot=i,i=a;for(i===a&&(i=null),44===e.charCodeAt(Ot)?(c=w,Ot++):(c=a,0===Ht&&Tt(ke)),c===a&&(c=null),h=[],v=mr();v!==a;)h.push(v),v=mr();if((v=Kt())!==a)if(41===e.charCodeAt(Ot)?(d=p,Ot++):(d=a,0===Ht&&Tt(fe)),d!==a){for(m=[],g=mr();g!==a;)m.push(g),g=mr();(g=Gt())!==a?(Et=t,t=gt(u,i,v,g)):(Ot=t,t=a)}else Ot=t,t=a;else Ot=t,t=a}else Ot=t,t=a;else Ot=t,t=a;else Ot=t,t=a}else Ot=t,t=a;if(t===a){if(t=Ot,e.substr(Ot,3)===k?(r=k,Ot+=3):(r=a,0===Ht&&Tt(_e)),r!==a){if(s=[],(n=mr())!==a)for(;n!==a;)s.push(n),n=mr();else s=a;if(s!==a)if(35===e.charCodeAt(Ot)?(n=y,Ot++):(n=a,0===Ht&&Tt(ye)),n!==a)if((o=vr())!==a){for(u=[],l=mr();l!==a;)u.push(l),l=mr();if(l=Ot,61===e.charCodeAt(Ot)?(i=x,Ot++):(i=a,0===Ht&&Tt(xe)),i!==a){for(c=[],h=mr();h!==a;)c.push(h),h=mr();(h=Kt())!==a?(Et=l,l=mt(0,h)):(Ot=l,l=a)}else Ot=l,l=a;for(l===a&&(l=null),44===e.charCodeAt(Ot)?(i=w,Ot++):(i=a,0===Ht&&Tt(ke)),i===a&&(i=null),c=[],h=mr();h!==a;)c.push(h),h=mr();if((h=Kt())!==a){if(v=[],(d=mr())!==a)for(;d!==a;)v.push(d),d=mr();else v=a;v!==a&&(d=Gt())!==a?(Et=t,t=gt(o,l,h,d)):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a;else Ot=t,t=a;else Ot=t,t=a}else Ot=t,t=a;if(t===a){if(t=Ot,e.substr(Ot,3)===k?(r=k,Ot+=3):(r=a,0===Ht&&Tt(_e)),r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if(40===e.charCodeAt(Ot)?(n=f,Ot++):(n=a,0===Ht&&Tt(ie)),n!==a)if((o=Kt())!==a)if(41===e.charCodeAt(Ot)?(u=p,Ot++):(u=a,0===Ht&&Tt(fe)),u!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();(i=Gt())!==a?(Et=t,t=bt(o,i)):(Ot=t,t=a)}else Ot=t,t=a;else Ot=t,t=a;else Ot=t,t=a}else Ot=t,t=a;if(t===a)if(t=Ot,e.substr(Ot,3)===k?(r=k,Ot+=3):(r=a,0===Ht&&Tt(_e)),r!==a){if(s=[],(n=mr())!==a)for(;n!==a;)s.push(n),n=mr();else s=a;if(s!==a)if((n=Kt())!==a){if(o=[],(u=mr())!==a)for(;u!==a;)o.push(u),u=mr();else o=a;o!==a&&(u=Gt())!==a?(Et=t,t=bt(n,u)):(Ot=t,t=a)}else Ot=t,t=a;else Ot=t,t=a}else Ot=t,t=a}}return It[b]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l,i,c=70*Ot+23,f=It[c];if(f)return Ot=f.nextPos,f.result;t=Ot,e.substr(Ot,4)===S?(r=S,Ot+=4):(r=a,0===Ht&&Tt(je));if(r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if(123===e.charCodeAt(Ot)?(n=h,Ot++):(n=a,0===Ht&&Tt(he)),n!==a){for(o=[],u=mr();u!==a;)o.push(u),u=mr();if((u=Vt())!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();125===e.charCodeAt(Ot)?(i=v,Ot++):(i=a,0===Ht&&Tt(ve)),i!==a?(Et=t,t=Ar("loop",{statements:u})):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a}else Ot=t,t=a;return It[c]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o=70*Ot+24,u=It[o];if(u)return Ot=u.nextPos,u.result;t=Ot,e.substr(Ot,5)===j?(r=j,Ot+=5):(r=a,0===Ht&&Tt(Me));r!==a?(s=Ot,Ht++,K.test(e.charAt(Ot))?(n=e.charAt(Ot),Ot++):(n=a,0===Ht&&Tt(Oe)),Ht--,n===a?s=void 0:(Ot=s,s=a),s!==a?(Et=t,t=Ar("break",{})):(Ot=t,t=a)):(Ot=t,t=a);return It[o]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o=70*Ot+25,u=It[o];if(u)return Ot=u.nextPos,u.result;t=Ot,e.substr(Ot,8)===M?(r=M,Ot+=8):(r=a,0===Ht&&Tt(Ee));r!==a?(s=Ot,Ht++,K.test(e.charAt(Ot))?(n=e.charAt(Ot),Ot++):(n=a,0===Ht&&Tt(Oe)),Ht--,n===a?s=void 0:(Ot=s,s=a),s!==a?(Et=t,t=Ar("continue",{})):(Ot=t,t=a)):(Ot=t,t=a);return It[o]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l=70*Ot+26,i=It[l];if(i)return Ot=i.nextPos,i.result;if(t=Ot,(r=dr())!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if(e.substr(Ot,2)===m?(n=m,Ot+=2):(n=a,0===Ht&&Tt(ge)),n!==a){for(o=[],u=mr();u!==a;)o.push(u),u=mr();(u=Kt())!==a?(Et=t,t=Ar("assign",{name:r,expr:u})):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a;return It[l]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l,i=70*Ot+27,c=It[i];if(c)return Ot=c.nextPos,c.result;if(t=Ot,(r=dr())!==a){if(s=[],n=Ot,46===e.charCodeAt(Ot)?(o=O,Ot++):(o=a,0===Ht&&Tt($e)),o!==a&&(u=vr())!==a?(Et=n,n=At(0,u)):(Ot=n,n=a),n!==a)for(;n!==a;)s.push(n),n=Ot,46===e.charCodeAt(Ot)?(o=O,Ot++):(o=a,0===Ht&&Tt($e)),o!==a&&(u=vr())!==a?(Et=n,n=At(0,u)):(Ot=n,n=a);else s=a;if(s!==a){for(n=[],o=mr();o!==a;)n.push(o),o=mr();if(e.substr(Ot,2)===m?(o=m,Ot+=2):(o=a,0===Ht&&Tt(ge)),o!==a){for(u=[],l=mr();l!==a;)u.push(l),l=mr();(l=Kt())!==a?(Et=t,t=Ar("propAssign",{obj:r,path:s,expr:l})):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a}else Ot=t,t=a;return It[i]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l,i,c,f,p,h=70*Ot+28,v=It[h];if(v)return Ot=v.nextPos,v.result;if(t=Ot,(r=dr())!==a)if(91===e.charCodeAt(Ot)?(s=E,Ot++):(s=a,0===Ht&&Tt(Ne)),s!==a){for(n=[],o=mr();o!==a;)n.push(o),o=mr();if((o=Kt())!==a){for(u=[],l=mr();l!==a;)u.push(l),l=mr();if(93===e.charCodeAt(Ot)?(l=P,Ot++):(l=a,0===Ht&&Tt(Ce)),l!==a){for(i=[],c=mr();c!==a;)i.push(c),c=mr();if(e.substr(Ot,2)===m?(c=m,Ot+=2):(c=a,0===Ht&&Tt(ge)),c!==a){for(f=[],p=mr();p!==a;)f.push(p),p=mr();(p=Kt())!==a?(Et=t,t=Ar("indexAssign",{arr:r,i:o,expr:p})):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a}else Ot=t,t=a}else Ot=t,t=a;else Ot=t,t=a;return It[h]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l=70*Ot+29,i=It[l];if(i)return Ot=i.nextPos,i.result;if(t=Ot,(r=dr())!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if(e.substr(Ot,3)===$?(n=$,Ot+=3):(n=a,0===Ht&&Tt(De)),n!==a){for(o=[],u=mr();u!==a;)o.push(u),u=mr();(u=Kt())!==a?(Et=t,t=Ar("inc",{name:r,expr:u})):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a;return It[l]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l=70*Ot+30,i=It[l];if(i)return Ot=i.nextPos,i.result;if(t=Ot,(r=dr())!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if(e.substr(Ot,3)===N?(n=N,Ot+=3):(n=a,0===Ht&&Tt(He)),n!==a){for(o=[],u=mr();u!==a;)o.push(u),u=mr();(u=Kt())!==a?(Et=t,t=Ar("dec",{name:r,expr:u})):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a;return It[l]={nextPos:Ot,result:t},t}())===a&&(t=Kt()),It[r]={nextPos:Ot,result:t},t)}function Kt(){var e,t=70*Ot+10,r=It[t];return r?(Ot=r.nextPos,r.result):((e=function(){var e,t,r,s,n,o,u,l,i=70*Ot+31,c=It[i];if(c)return Ot=c.nextPos,c.result;if(e=Ot,(t=Qt())!==a){for(r=[],s=Ot,n=[],o=tr();o!==a;)n.push(o),o=tr();if((o=rr())!==a){for(u=[],l=tr();l!==a;)u.push(l),l=tr();(l=Qt())!==a?(Et=s,s=Pt(0,o,l)):(Ot=s,s=a)}else Ot=s,s=a;if(s!==a)for(;s!==a;){for(r.push(s),s=Ot,n=[],o=tr();o!==a;)n.push(o),o=tr();if((o=rr())!==a){for(u=[],l=tr();l!==a;)u.push(l),l=tr();(l=Qt())!==a?(Et=s,s=Pt(0,o,l)):(Ot=s,s=a)}else Ot=s,s=a}else r=a;r!==a?(Et=e,e=Ar("infix",{operands:[t,...(f=r).map((e=>e.t))],operators:f.map((e=>e.o))})):(Ot=e,e=a)}else Ot=e,e=a;var f;return It[i]={nextPos:Ot,result:e},e}())===a&&(e=Qt()),It[t]={nextPos:Ot,result:e},e)}function Qt(){var t,r,s,n,o,u,l=70*Ot+11,i=It[l];if(i)return Ot=i.nextPos,i.result;if((t=function(){var t,r,s,n,o,u,l,i,c,f,p=70*Ot+35,h=It[p];if(h)return Ot=h.nextPos,h.result;t=Ot,e.substr(Ot,2)===H?(r=H,Ot+=2):(r=a,0===Ht&&Tt(ze));if(r!==a){if(s=[],(n=mr())!==a)for(;n!==a;)s.push(n),n=mr();else s=a;if(s!==a)if((n=Kt())!==a){if(o=[],(u=mr())!==a)for(;u!==a;)o.push(u),u=mr();else o=a;if(o!==a)if((u=Gt())!==a){if(l=Ot,i=[],(c=mr())!==a)for(;c!==a;)i.push(c),c=mr();else i=a;if(i!==a&&(c=function(){var e,t,r,s,n,o,u=70*Ot+36,l=It[u];if(l)return Ot=l.nextPos,l.result;if(e=Ot,(t=sr())!==a){for(r=[],s=Ot,n=[],o=mr();o!==a;)n.push(o),o=mr();for((o=sr())!==a?s=o:(Ot=s,s=a);s!==a;){for(r.push(s),s=Ot,n=[],o=mr();o!==a;)n.push(o),o=mr();(o=sr())!==a?s=o:(Ot=s,s=a)}Et=e,e=yt(t,r)}else Ot=e,e=a;return It[u]={nextPos:Ot,result:e},e}())!==a?l=c:(Ot=l,l=a),l===a&&(l=null),i=Ot,c=[],(f=mr())!==a)for(;f!==a;)c.push(f),f=mr();else c=a;c!==a&&(f=function(){var t,r,s,n,o=70*Ot+38,u=It[o];if(u)return Ot=u.nextPos,u.result;t=Ot,e.substr(Ot,4)===q?(r=q,Ot+=4):(r=a,0===Ht&&Tt(Re));if(r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();(n=Gt())!==a?(Et=t,t=n):(Ot=t,t=a)}else Ot=t,t=a;return It[o]={nextPos:Ot,result:t},t}())!==a?i=f:(Ot=i,i=a),i===a&&(i=null),Et=t,t=Ar("if",{cond:n,then:u,elseif:l||[],else:i})}else Ot=t,t=a;else Ot=t,t=a}else Ot=t,t=a;else Ot=t,t=a}else Ot=t,t=a;return It[p]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l,i,c,f,d,y,x=70*Ot+61,m=It[x];if(m)return Ot=m.nextPos,m.result;t=Ot,e.substr(Ot,2)===G?(r=G,Ot+=2):(r=a,0===Ht&&Tt(ot));if(r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();for((n=pr())===a&&(n=null),o=[],u=mr();u!==a;)o.push(u),u=mr();if(41===e.charCodeAt(Ot)?(u=p,Ot++):(u=a,0===Ht&&Tt(fe)),u!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();if(123===e.charCodeAt(Ot)?(i=h,Ot++):(i=a,0===Ht&&Tt(he)),i!==a){for(c=[],f=mr();f!==a;)c.push(f),f=mr();for((f=Vt())===a&&(f=null),d=[],y=mr();y!==a;)d.push(y),y=mr();125===e.charCodeAt(Ot)?(y=v,Ot++):(y=a,0===Ht&&Tt(ve)),y!==a?(Et=t,t=Ar("fn",{args:n},f||[])):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a}else Ot=t,t=a;return It[x]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l,i,c,f,p,d,y,x,m,g,b=70*Ot+39,A=It[b];if(A)return Ot=A.nextPos,A.result;t=Ot,e.substr(Ot,5)===F?(r=F,Ot+=5):(r=a,0===Ht&&Tt(Te));if(r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if((n=Kt())!==a){for(o=[],u=mr();u!==a;)o.push(u),u=mr();if(123===e.charCodeAt(Ot)?(u=h,Ot++):(u=a,0===Ht&&Tt(he)),u!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();if(i=[],c=Ot,(f=Kt())!==a){for(p=[],d=mr();d!==a;)p.push(d),d=mr();if(e.substr(Ot,2)===D?(d=D,Ot+=2):(d=a,0===Ht&&Tt(qe)),d!==a){for(y=[],x=mr();x!==a;)y.push(x),x=mr();if((x=Kt())!==a){for(m=[],g=mr();g!==a;)m.push(g),g=mr();Et=c,c=Ct(0,f,x)}else Ot=c,c=a}else Ot=c,c=a}else Ot=c,c=a;if(c!==a)for(;c!==a;)if(i.push(c),c=Ot,(f=Kt())!==a){for(p=[],d=mr();d!==a;)p.push(d),d=mr();if(e.substr(Ot,2)===D?(d=D,Ot+=2):(d=a,0===Ht&&Tt(qe)),d!==a){for(y=[],x=mr();x!==a;)y.push(x),x=mr();if((x=Kt())!==a){for(m=[],g=mr();g!==a;)m.push(g),g=mr();Et=c,c=Ct(0,f,x)}else Ot=c,c=a}else Ot=c,c=a}else Ot=c,c=a;else i=a;if(i!==a){if(c=Ot,42===e.charCodeAt(Ot)?(f="*",Ot++):(f=a,0===Ht&&Tt(Je)),f!==a){for(p=[],d=mr();d!==a;)p.push(d),d=mr();if(e.substr(Ot,2)===D?(d=D,Ot+=2):(d=a,0===Ht&&Tt(qe)),d!==a){for(y=[],x=mr();x!==a;)y.push(x),x=mr();if((x=Kt())!==a){for(m=[],g=mr();g!==a;)m.push(g),g=mr();Et=c,c=x}else Ot=c,c=a}else Ot=c,c=a}else Ot=c,c=a;for(c===a&&(c=null),f=[],p=mr();p!==a;)f.push(p),p=mr();125===e.charCodeAt(Ot)?(p=v,Ot++):(p=a,0===Ht&&Tt(ve)),p!==a?(Et=t,t=Ar("match",{about:n,qs:i||[],default:c})):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a}else Ot=t,t=a}else Ot=t,t=a;return It[b]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l=70*Ot+40,i=It[l];if(i)return Ot=i.nextPos,i.result;t=Ot,123===e.charCodeAt(Ot)?(r=h,Ot++):(r=a,0===Ht&&Tt(he));if(r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if((n=Vt())!==a){for(o=[],u=mr();u!==a;)o.push(u),u=mr();125===e.charCodeAt(Ot)?(u=v,Ot++):(u=a,0===Ht&&Tt(ve)),u!==a?(Et=t,t=Ar("block",{statements:n})):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a;return It[l]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r=70*Ot+12,s=It[r];if(s)return Ot=s.nextPos,s.result;(t=or())===a&&(t=ur())===a&&(t=ir())===a&&(t=cr())===a&&(t=fr())===a&&(t=function(){var t,r,s,n,o,u,l,i,c,f,p,d,y,x,m=70*Ot+57,g=It[m];if(g)return Ot=g.nextPos,g.result;t=Ot,123===e.charCodeAt(Ot)?(r=h,Ot++):(r=a,0===Ht&&Tt(he));if(r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if(n=[],o=Ot,(u=vr())!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();if(58===e.charCodeAt(Ot)?(i=L,Ot++):(i=a,0===Ht&&Tt(rt)),i!==a){if(c=[],(f=mr())!==a)for(;f!==a;)c.push(f),f=mr();else c=a;if(c!==a)if((f=Kt())!==a){for(p=[],d=mr();d!==a;)p.push(d),d=mr();for(44===e.charCodeAt(Ot)?(d=w,Ot++):(d=a,0===Ht&&Tt(ke)),d===a&&(59===e.charCodeAt(Ot)?(d=Y,Ot++):(d=a,0===Ht&&Tt(st))),d===a&&(d=null),y=[],x=mr();x!==a;)y.push(x),x=mr();Et=o,o=St(u,f)}else Ot=o,o=a;else Ot=o,o=a}else Ot=o,o=a}else Ot=o,o=a;for(;o!==a;)if(n.push(o),o=Ot,(u=vr())!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();if(58===e.charCodeAt(Ot)?(i=L,Ot++):(i=a,0===Ht&&Tt(rt)),i!==a){if(c=[],(f=mr())!==a)for(;f!==a;)c.push(f),f=mr();else c=a;if(c!==a)if((f=Kt())!==a){for(p=[],d=mr();d!==a;)p.push(d),d=mr();for(44===e.charCodeAt(Ot)?(d=w,Ot++):(d=a,0===Ht&&Tt(ke)),d===a&&(59===e.charCodeAt(Ot)?(d=Y,Ot++):(d=a,0===Ht&&Tt(st))),d===a&&(d=null),y=[],x=mr();x!==a;)y.push(x),x=mr();Et=o,o=St(u,f)}else Ot=o,o=a;else Ot=o,o=a}else Ot=o,o=a}else Ot=o,o=a;125===e.charCodeAt(Ot)?(o=v,Ot++):(o=a,0===Ht&&Tt(ve)),o!==a?(Et=t,t=jt(n)):(Ot=t,t=a)}else Ot=t,t=a;return It[m]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l,i,c,f,p=70*Ot+58,h=It[p];if(h)return Ot=h.nextPos,h.result;t=Ot,91===e.charCodeAt(Ot)?(r=E,Ot++):(r=a,0===Ht&&Tt(Ne));if(r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if(n=[],o=Ot,(u=Kt())!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();for(44===e.charCodeAt(Ot)?(i=w,Ot++):(i=a,0===Ht&&Tt(ke)),i===a&&(i=null),c=[],f=mr();f!==a;)c.push(f),f=mr();Et=o,o=u}else Ot=o,o=a;for(;o!==a;)if(n.push(o),o=Ot,(u=Kt())!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();for(44===e.charCodeAt(Ot)?(i=w,Ot++):(i=a,0===Ht&&Tt(ke)),i===a&&(i=null),c=[],f=mr();f!==a;)c.push(f),f=mr();Et=o,o=u}else Ot=o,o=a;for(o=[],u=mr();u!==a;)o.push(u),u=mr();93===e.charCodeAt(Ot)?(u=P,Ot++):(u=a,0===Ht&&Tt(Ce)),u!==a?(Et=t,t=Mt(n)):(Ot=t,t=a)}else Ot=t,t=a;return It[p]={nextPos:Ot,result:t},t}());return It[r]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l,i=70*Ot+41,c=It[i];if(c)return Ot=c.nextPos,c.result;if(t=Ot,(r=dr())!==a)if(40===e.charCodeAt(Ot)?(s=f,Ot++):(s=a,0===Ht&&Tt(ie)),s!==a){for(n=[],o=mr();o!==a;)n.push(o),o=mr();for((o=nr())===a&&(o=null),u=[],l=mr();l!==a;)u.push(l),l=mr();41===e.charCodeAt(Ot)?(l=p,Ot++):(l=a,0===Ht&&Tt(fe)),l!==a?(Et=t,t=Ar("call",{name:r,args:o||[]})):(Ot=t,t=a)}else Ot=t,t=a;else Ot=t,t=a;return It[i]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l,i=70*Ot+43,c=It[i];if(c)return Ot=c.nextPos,c.result;if(t=Ot,(r=dr())!==a)if(91===e.charCodeAt(Ot)?(s=E,Ot++):(s=a,0===Ht&&Tt(Ne)),s!==a){for(n=[],o=mr();o!==a;)n.push(o),o=mr();if((o=Kt())!==a){for(u=[],l=mr();l!==a;)u.push(l),l=mr();93===e.charCodeAt(Ot)?(l=P,Ot++):(l=a,0===Ht&&Tt(Ce)),l!==a?(Et=t,t=Ar("index",{arr:r,i:o})):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a;else Ot=t,t=a;return It[i]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l,i,c=70*Ot+44,h=It[c];if(h)return Ot=h.nextPos,h.result;if(t=Ot,(r=dr())!==a){if(s=[],n=Ot,46===e.charCodeAt(Ot)?(o=O,Ot++):(o=a,0===Ht&&Tt($e)),o!==a&&(u=vr())!==a?(Et=n,n=At(0,u)):(Ot=n,n=a),n!==a)for(;n!==a;)s.push(n),n=Ot,46===e.charCodeAt(Ot)?(o=O,Ot++):(o=a,0===Ht&&Tt($e)),o!==a&&(u=vr())!==a?(Et=n,n=At(0,u)):(Ot=n,n=a);else s=a;if(s!==a)if(40===e.charCodeAt(Ot)?(n=f,Ot++):(n=a,0===Ht&&Tt(ie)),n!==a){for(o=[],u=mr();u!==a;)o.push(u),u=mr();for((u=nr())===a&&(u=null),l=[],i=mr();i!==a;)l.push(i),i=mr();41===e.charCodeAt(Ot)?(i=p,Ot++):(i=a,0===Ht&&Tt(fe)),i!==a?(Et=t,t=Ar("propCall",{obj:r,path:s,args:u||[]})):(Ot=t,t=a)}else Ot=t,t=a;else Ot=t,t=a}else Ot=t,t=a;return It[c]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l=70*Ot+45,i=It[l];if(i)return Ot=i.nextPos,i.result;if(t=Ot,(r=dr())!==a){if(s=[],n=Ot,46===e.charCodeAt(Ot)?(o=O,Ot++):(o=a,0===Ht&&Tt($e)),o!==a&&(u=vr())!==a?(Et=n,n=At(0,u)):(Ot=n,n=a),n!==a)for(;n!==a;)s.push(n),n=Ot,46===e.charCodeAt(Ot)?(o=O,Ot++):(o=a,0===Ht&&Tt($e)),o!==a&&(u=vr())!==a?(Et=n,n=At(0,u)):(Ot=n,n=a);else s=a;s!==a?(Et=t,t=Ar("prop",{obj:r,path:s})):(Ot=t,t=a)}else Ot=t,t=a;return It[l]={nextPos:Ot,result:t},t}())===a&&(t=function(){var e,t,r=70*Ot+46,s=It[r];if(s)return Ot=s.nextPos,s.result;e=Ot,(t=dr())!==a&&(Et=e,t=Ar("var",{name:t}));return e=t,It[r]={nextPos:Ot,result:e},e}())===a)if(t=Ot,40===e.charCodeAt(Ot)?(r=f,Ot++):(r=a,0===Ht&&Tt(ie)),r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if((n=Kt())!==a){for(o=[],u=mr();u!==a;)o.push(u),u=mr();41===e.charCodeAt(Ot)?(u=p,Ot++):(u=a,0===Ht&&Tt(fe)),u!==a?(Et=t,t=n):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a;return It[l]={nextPos:Ot,result:t},t}function Wt(){var t,r=70*Ot+13,s=It[r];return s?(Ot=s.nextPos,s.result):((t=ir())===a&&(t=ur())===a&&(t=cr())===a&&(t=function(){var t,r,s,n,o,u,l,i,c,f,p=70*Ot+62,h=It[p];if(h)return Ot=h.nextPos,h.result;t=Ot,91===e.charCodeAt(Ot)?(r=E,Ot++):(r=a,0===Ht&&Tt(Ne));if(r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if(n=[],o=Ot,(u=Wt())!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();for(44===e.charCodeAt(Ot)?(i=w,Ot++):(i=a,0===Ht&&Tt(ke)),i===a&&(i=null),c=[],f=mr();f!==a;)c.push(f),f=mr();Et=o,o=u}else Ot=o,o=a;for(;o!==a;)if(n.push(o),o=Ot,(u=Wt())!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();for(44===e.charCodeAt(Ot)?(i=w,Ot++):(i=a,0===Ht&&Tt(ke)),i===a&&(i=null),c=[],f=mr();f!==a;)c.push(f),f=mr();Et=o,o=u}else Ot=o,o=a;for(o=[],u=mr();u!==a;)o.push(u),u=mr();93===e.charCodeAt(Ot)?(u=P,Ot++):(u=a,0===Ht&&Tt(Ce)),u!==a?(Et=t,t=Mt(n)):(Ot=t,t=a)}else Ot=t,t=a;return It[p]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o,u,l,i,c,f,p,d,y,x,m=70*Ot+63,g=It[m];if(g)return Ot=g.nextPos,g.result;t=Ot,123===e.charCodeAt(Ot)?(r=h,Ot++):(r=a,0===Ht&&Tt(he));if(r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if(n=[],o=Ot,(u=vr())!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();if(58===e.charCodeAt(Ot)?(i=L,Ot++):(i=a,0===Ht&&Tt(rt)),i!==a){if(c=[],(f=mr())!==a)for(;f!==a;)c.push(f),f=mr();else c=a;if(c!==a)if((f=Wt())!==a){for(p=[],d=mr();d!==a;)p.push(d),d=mr();for(44===e.charCodeAt(Ot)?(d=w,Ot++):(d=a,0===Ht&&Tt(ke)),d===a&&(59===e.charCodeAt(Ot)?(d=Y,Ot++):(d=a,0===Ht&&Tt(st))),d===a&&(d=null),y=[],x=mr();x!==a;)y.push(x),x=mr();Et=o,o=St(u,f)}else Ot=o,o=a;else Ot=o,o=a}else Ot=o,o=a}else Ot=o,o=a;for(;o!==a;)if(n.push(o),o=Ot,(u=vr())!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();if(58===e.charCodeAt(Ot)?(i=L,Ot++):(i=a,0===Ht&&Tt(rt)),i!==a){if(c=[],(f=mr())!==a)for(;f!==a;)c.push(f),f=mr();else c=a;if(c!==a)if((f=Wt())!==a){for(p=[],d=mr();d!==a;)p.push(d),d=mr();for(44===e.charCodeAt(Ot)?(d=w,Ot++):(d=a,0===Ht&&Tt(ke)),d===a&&(59===e.charCodeAt(Ot)?(d=Y,Ot++):(d=a,0===Ht&&Tt(st))),d===a&&(d=null),y=[],x=mr();x!==a;)y.push(x),x=mr();Et=o,o=St(u,f)}else Ot=o,o=a;else Ot=o,o=a}else Ot=o,o=a}else Ot=o,o=a;125===e.charCodeAt(Ot)?(o=v,Ot++):(o=a,0===Ht&&Tt(ve)),o!==a?(Et=t,t=jt(n)):(Ot=t,t=a)}else Ot=t,t=a;return It[m]={nextPos:Ot,result:t},t}())===a&&(t=fr()),It[r]={nextPos:Ot,result:t},t)}function Xt(){var t,r,s,n,o,u,l,i,c,f,p=70*Ot+14,d=It[p];if(d)return Ot=d.nextPos,d.result;if(t=Ot,"::"===e.substr(Ot,2)?(r="::",Ot+=2):(r=a,0===Ht&&Tt(pe)),r!==a){if(s=[],(n=mr())!==a)for(;n!==a;)s.push(n),n=mr();else s=a;if(s!==a)if((n=vr())!==a){if(o=[],(u=mr())!==a)for(;u!==a;)o.push(u),u=mr();else o=a;if(o!==a)if(123===e.charCodeAt(Ot)?(u=h,Ot++):(u=a,0===Ht&&Tt(he)),u!==a){for(l=[],i=mr();i!==a;)l.push(i),i=mr();for((i=function(){var e,t,r,s,n,o,u,l,i=70*Ot+5,c=It[i];if(c)return Ot=c.nextPos,c.result;if(e=Ot,(t=Yt())!==a){for(r=[],s=Ot,n=[],o=gr();o!==a;)n.push(o),o=gr();if((o=yr())!==a){for(u=[],l=mr();l!==a;)u.push(l),l=mr();(l=Yt())!==a?(Et=s,s=dt(0,l)):(Ot=s,s=a)}else Ot=s,s=a;for(;s!==a;){for(r.push(s),s=Ot,n=[],o=gr();o!==a;)n.push(o),o=gr();if((o=yr())!==a){for(u=[],l=mr();l!==a;)u.push(l),l=mr();(l=Yt())!==a?(Et=s,s=dt(0,l)):(Ot=s,s=a)}else Ot=s,s=a}Et=e,e=yt(t,r)}else Ot=e,e=a;return It[i]={nextPos:Ot,result:e},e}())===a&&(i=null),c=[],f=mr();f!==a;)c.push(f),f=mr();125===e.charCodeAt(Ot)?(f=v,Ot++):(f=a,0===Ht&&Tt(ve)),f!==a?(Et=t,t=Ar("ns",{name:n,members:i})):(Ot=t,t=a)}else Ot=t,t=a;else Ot=t,t=a}else Ot=t,t=a;else Ot=t,t=a}else Ot=t,t=a;return It[p]={nextPos:Ot,result:t},t}function er(){var t,r,s,n,o,u,l,i=70*Ot+16,c=It[i];if(c)return Ot=c.nextPos,c.result;if(t=Ot,35===e.charCodeAt(Ot)?(r=y,Ot++):(r=a,0===Ht&&Tt(ye)),r!==a)if((s=vr())!==a){for(n=[],o=mr();o!==a;)n.push(o),o=mr();if(61===e.charCodeAt(Ot)?(o=x,Ot++):(o=a,0===Ht&&Tt(xe)),o!==a){for(u=[],l=mr();l!==a;)u.push(l),l=mr();(l=Kt())!==a?(Et=t,t=Ar("def",{name:s,expr:l,mut:!1,attr:[]})):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a;else Ot=t,t=a;if(t===a)if(t=Ot,36===e.charCodeAt(Ot)?(r="$",Ot++):(r=a,0===Ht&&Tt(me)),r!==a)if((s=vr())!==a){for(n=[],o=mr();o!==a;)n.push(o),o=mr();if(e.substr(Ot,2)===m?(o=m,Ot+=2):(o=a,0===Ht&&Tt(ge)),o!==a){for(u=[],l=mr();l!==a;)u.push(l),l=mr();(l=Kt())!==a?(Et=t,t=function(e,t){return Ar("def",{name:e,expr:t,mut:!0,attr:[]})}(s,l)):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a;else Ot=t,t=a;return It[i]={nextPos:Ot,result:t},t}function tr(){var t,r,s,n=70*Ot+32,o=It[n];return o?(Ot=o.nextPos,o.result):(t=Ot,92===e.charCodeAt(Ot)?(r="\\",Ot++):(r=a,0===Ht&&Tt(Ie)),r!==a&&(s=yr())!==a?t=r=[r,s]:(Ot=t,t=a),t===a&&(t=gr()),It[n]={nextPos:Ot,result:t},t)}function rr(){var t,r,s,n,o,u,l=70*Ot+34,i=It[l];if(i)return Ot=i.nextPos,i.result;if(t=Ot,r=Ot,Ht++,s=Ot,(n=function(){var t,r=70*Ot+33,s=It[r];return s?(Ot=s.nextPos,s.result):(e.substr(Ot,3)===b?(t=b,Ot+=3):(t=a,0===Ht&&Tt(Ae)),t===a&&(e.substr(Ot,2)===D?(t=D,Ot+=2):(t=a,0===Ht&&Tt(qe)),t===a&&(e.substr(Ot,2)===m?(t=m,Ot+=2):(t=a,0===Ht&&Tt(ge)),t===a&&(e.substr(Ot,3)===$?(t=$,Ot+=3):(t=a,0===Ht&&Tt(De)),t===a&&(e.substr(Ot,3)===N?(t=N,Ot+=3):(t=a,0===Ht&&Tt(He)))))),It[r]={nextPos:Ot,result:t},t)}())!==a?(o=Ot,Ht++,Q.test(e.charAt(Ot))?(u=e.charAt(Ot),Ot++):(u=a,0===Ht&&Tt(Fe)),Ht--,u===a?o=void 0:(Ot=o,o=a),o!==a?s=n=[n,o]:(Ot=s,s=a)):(Ot=s,s=a),Ht--,s===a?r=void 0:(Ot=r,r=a),r!==a){if(s=[],Q.test(e.charAt(Ot))?(n=e.charAt(Ot),Ot++):(n=a,0===Ht&&Tt(Fe)),n!==a)for(;n!==a;)s.push(n),Q.test(e.charAt(Ot))?(n=e.charAt(Ot),Ot++):(n=a,0===Ht&&Tt(Fe));else s=a;s!==a?(Et=t,t=Ar("operator",{op:qt()})):(Ot=t,t=a)}else Ot=t,t=a;return It[l]={nextPos:Ot,result:t},t}function sr(){var t,r,s,n,o,u,l=70*Ot+37,i=It[l];if(i)return Ot=i.nextPos,i.result;if(t=Ot,e.substr(Ot,4)===I?(r=I,Ot+=4):(r=a,0===Ht&&Tt(Ue)),r!==a){for(s=[],n=mr();n!==a;)s.push(n),n=mr();if((n=Kt())!==a){for(o=[],u=mr();u!==a;)o.push(u),u=mr();(u=Gt())!==a?(Et=t,t={cond:n,then:u}):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a;return It[l]={nextPos:Ot,result:t},t}function nr(){var t,r,s,n,o,u,l=70*Ot+42,i=It[l];if(i)return Ot=i.nextPos,i.result;if(t=Ot,(r=Kt())!==a){if(s=[],n=Ot,44===e.charCodeAt(Ot)?Ot++:0===Ht&&Tt(ke),o=[],(u=mr())!==a)for(;u!==a;)o.push(u),u=mr();else o=a;for(o!==a&&(u=Kt())!==a?(Et=n,n=wt(0,u)):(Ot=n,n=a);n!==a;){if(s.push(n),n=Ot,44===e.charCodeAt(Ot)?Ot++:0===Ht&&Tt(ke),o=[],(u=mr())!==a)for(;u!==a;)o.push(u),u=mr();else o=a;o!==a&&(u=Kt())!==a?(Et=n,n=wt(0,u)):(Ot=n,n=a)}Et=t,t=yt(r,s)}else Ot=t,t=a;return It[l]={nextPos:Ot,result:t},t}function or(){var t,r,s,n,o,u,l=70*Ot+47,i=It[l];if(i)return Ot=i.nextPos,i.result;if(t=Ot,96===e.charCodeAt(Ot)?(r=z,Ot++):(r=a,0===Ht&&Tt(Ze)),r!==a){for(s=[],n=Ot,o=Ot,Ht++,96===e.charCodeAt(Ot)?(u=z,Ot++):(u=a,0===Ht&&Tt(Ze)),Ht--,u===a?o=void 0:(Ot=o,o=a),o!==a&&(u=ar())!==a?(Et=n,n=u):(Ot=n,n=a);n!==a;)s.push(n),n=Ot,o=Ot,Ht++,96===e.charCodeAt(Ot)?(u=z,Ot++):(u=a,0===Ht&&Tt(Ze)),Ht--,u===a?o=void 0:(Ot=o,o=a),o!==a&&(u=ar())!==a?(Et=n,n=u):(Ot=n,n=a);96===e.charCodeAt(Ot)?(n=z,Ot++):(n=a,0===Ht&&Tt(Ze)),n!==a?(Et=t,t=Ar("tmpl",{tmpl:br(s)})):(Ot=t,t=a)}else Ot=t,t=a;return It[l]={nextPos:Ot,result:t},t}function ar(){var t,r,s,n,o,u,l=70*Ot+48,i=It[l];if(i)return Ot=i.nextPos,i.result;if((t=function(){var t,r,s=70*Ot+49,n=It[s];if(n)return Ot=n.nextPos,n.result;t=Ot,e.substr(Ot,2)===U?(r=U,Ot+=2):(r=a,0===Ht&&Tt(Be));r!==a&&(Et=t,r=kt());(t=r)===a&&(t=Ot,e.substr(Ot,2)===R?(r=R,Ot+=2):(r=a,0===Ht&&Tt(Ve)),r!==a&&(Et=t,r=kt()),(t=r)===a&&(t=Ot,e.substr(Ot,2)===T?(r=T,Ot+=2):(r=a,0===Ht&&Tt(Le)),r!==a&&(Et=t,r="`"),t=r));return It[s]={nextPos:Ot,result:t},t}())===a){if(t=Ot,123===e.charCodeAt(Ot)?(r=h,Ot++):(r=a,0===Ht&&Tt(he)),r!==a){for(s=[],n=gr();n!==a;)s.push(n),n=gr();if((n=Kt())!==a){for(o=[],u=gr();u!==a;)o.push(u),u=gr();125===e.charCodeAt(Ot)?(u=v,Ot++):(u=a,0===Ht&&Tt(ve)),u!==a?(Et=t,t=n):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a;t===a&&(e.length>Ot?(t=e.charAt(Ot),Ot++):(t=a,0===Ht&&Tt(ae)))}return It[l]={nextPos:Ot,result:t},t}function ur(){var t,r,s,n,o,u,l=70*Ot+50,i=It[l];if(i)return Ot=i.nextPos,i.result;if(t=Ot,34===e.charCodeAt(Ot)?(r=J,Ot++):(r=a,0===Ht&&Tt(Ye)),r!==a){for(s=[],n=Ot,o=Ot,Ht++,34===e.charCodeAt(Ot)?(u=J,Ot++):(u=a,0===Ht&&Tt(Ye)),Ht--,u===a?o=void 0:(Ot=o,o=a),o!==a?((u=lr())===a&&(e.length>Ot?(u=e.charAt(Ot),Ot++):(u=a,0===Ht&&Tt(ae))),u!==a?(Et=n,n=u):(Ot=n,n=a)):(Ot=n,n=a);n!==a;)s.push(n),n=Ot,o=Ot,Ht++,34===e.charCodeAt(Ot)?(u=J,Ot++):(u=a,0===Ht&&Tt(Ye)),Ht--,u===a?o=void 0:(Ot=o,o=a),o!==a?((u=lr())===a&&(e.length>Ot?(u=e.charAt(Ot),Ot++):(u=a,0===Ht&&Tt(ae))),u!==a?(Et=n,n=u):(Ot=n,n=a)):(Ot=n,n=a);34===e.charCodeAt(Ot)?(n=J,Ot++):(n=a,0===Ht&&Tt(Ye)),n!==a?(Et=t,t=Ar("str",{value:s.join("")})):(Ot=t,t=a)}else Ot=t,t=a;return It[l]={nextPos:Ot,result:t},t}function lr(){var t,r,s=70*Ot+51,n=It[s];return n?(Ot=n.nextPos,n.result):(t=Ot,'\\"'===e.substr(Ot,2)?(r='\\"',Ot+=2):(r=a,0===Ht&&Tt(Ge)),r!==a&&(Et=t,r='"'),t=r,It[s]={nextPos:Ot,result:t},t)}function ir(){var t,r,s,n,o=70*Ot+52,u=It[o];if(u)return Ot=u.nextPos,u.result;if(t=Ot,W.test(e.charAt(Ot))?(e.charAt(Ot),Ot++):0===Ht&&Tt(Ke),X.test(e.charAt(Ot))?(r=e.charAt(Ot),Ot++):(r=a,0===Ht&&Tt(Qe)),r!==a){if(s=[],ee.test(e.charAt(Ot))?(n=e.charAt(Ot),Ot++):(n=a,0===Ht&&Tt(We)),n!==a)for(;n!==a;)s.push(n),ee.test(e.charAt(Ot))?(n=e.charAt(Ot),Ot++):(n=a,0===Ht&&Tt(We));else s=a;s!==a?(Et=t,t=_t()):(Ot=t,t=a)}else Ot=t,t=a;return t===a&&(t=Ot,W.test(e.charAt(Ot))?(e.charAt(Ot),Ot++):0===Ht&&Tt(Ke),ee.test(e.charAt(Ot))?(r=e.charAt(Ot),Ot++):(r=a,0===Ht&&Tt(We)),r!==a?(Et=t,t=_t()):(Ot=t,t=a)),It[o]={nextPos:Ot,result:t},t}function cr(){var t,r=70*Ot+53,s=It[r];return s?(Ot=s.nextPos,s.result):((t=function(){var t,r,s,n,o=70*Ot+54,u=It[o];if(u)return Ot=u.nextPos,u.result;t=Ot,e.substr(Ot,3)===Z?(r=Z,Ot+=3):(r=a,0===Ht&&Tt(Xe));r!==a?(s=Ot,Ht++,K.test(e.charAt(Ot))?(n=e.charAt(Ot),Ot++):(n=a,0===Ht&&Tt(Oe)),Ht--,n===a?s=void 0:(Ot=s,s=a),s!==a?(Et=t,t=Ar("bool",{value:!0})):(Ot=t,t=a)):(Ot=t,t=a);return It[o]={nextPos:Ot,result:t},t}())===a&&(t=function(){var t,r,s,n,o=70*Ot+55,u=It[o];if(u)return Ot=u.nextPos,u.result;t=Ot,e.substr(Ot,2)===B?(r=B,Ot+=2):(r=a,0===Ht&&Tt(et));r!==a?(s=Ot,Ht++,K.test(e.charAt(Ot))?(n=e.charAt(Ot),Ot++):(n=a,0===Ht&&Tt(Oe)),Ht--,n===a?s=void 0:(Ot=s,s=a),s!==a?(Et=t,t=Ar("bool",{value:!1})):(Ot=t,t=a)):(Ot=t,t=a);return It[o]={nextPos:Ot,result:t},t}()),It[r]={nextPos:Ot,result:t},t)}function fr(){var t,r,s,n,o=70*Ot+56,u=It[o];return u?(Ot=u.nextPos,u.result):(t=Ot,e.substr(Ot,4)===V?(r=V,Ot+=4):(r=a,0===Ht&&Tt(tt)),r!==a?(s=Ot,Ht++,K.test(e.charAt(Ot))?(n=e.charAt(Ot),Ot++):(n=a,0===Ht&&Tt(Oe)),Ht--,n===a?s=void 0:(Ot=s,s=a),s!==a?(Et=t,t=Ar("null",{})):(Ot=t,t=a)):(Ot=t,t=a),It[o]={nextPos:Ot,result:t},t)}function pr(){var t,r,s,n,o,u,l=70*Ot+59,i=It[l];if(i)return Ot=i.nextPos,i.result;if(t=Ot,(r=vr())!==a){if(s=[],n=Ot,44===e.charCodeAt(Ot)?Ot++:0===Ht&&Tt(ke),o=[],(u=mr())!==a)for(;u!==a;)o.push(u),u=mr();else o=a;for(o!==a&&(u=vr())!==a?(Et=n,n=At(0,u)):(Ot=n,n=a);n!==a;){if(s.push(n),n=Ot,44===e.charCodeAt(Ot)?Ot++:0===Ht&&Tt(ke),o=[],(u=mr())!==a)for(;u!==a;)o.push(u),u=mr();else o=a;o!==a&&(u=vr())!==a?(Et=n,n=At(0,u)):(Ot=n,n=a)}Et=t,t=yt(r,s)}else Ot=t,t=a;return It[l]={nextPos:Ot,result:t},t}function hr(){var t,r,s,n,o,u,l,i,c,d,y,x,m,g,b=70*Ot+60,A=It[b];if(A)return Ot=A.nextPos,A.result;if(t=Ot,64===e.charCodeAt(Ot)?(r="@",Ot++):(r=a,0===Ht&&Tt(nt)),r!==a)if((s=vr())!==a)if(40===e.charCodeAt(Ot)?(n=f,Ot++):(n=a,0===Ht&&Tt(ie)),n!==a){for(o=[],u=mr();u!==a;)o.push(u),u=mr();for((u=pr())===a&&(u=null),l=[],i=mr();i!==a;)l.push(i),i=mr();if(41===e.charCodeAt(Ot)?(i=p,Ot++):(i=a,0===Ht&&Tt(fe)),i!==a){for(c=[],d=mr();d!==a;)c.push(d),d=mr();if(123===e.charCodeAt(Ot)?(d=h,Ot++):(d=a,0===Ht&&Tt(he)),d!==a){for(y=[],x=mr();x!==a;)y.push(x),x=mr();for((x=Vt())===a&&(x=null),m=[],g=mr();g!==a;)m.push(g),g=mr();125===e.charCodeAt(Ot)?(g=v,Ot++):(g=a,0===Ht&&Tt(ve)),g!==a?(Et=t,t=Ar("def",{name:s,expr:Ar("fn",{args:u},x||[]),mut:!1,attr:[]})):(Ot=t,t=a)}else Ot=t,t=a}else Ot=t,t=a}else Ot=t,t=a;else Ot=t,t=a;else Ot=t,t=a;return It[b]={nextPos:Ot,result:t},t}function vr(){var t,r,s,n,o=70*Ot+64,u=It[o];if(u)return Ot=u.nextPos,u.result;if(t=Ot,te.test(e.charAt(Ot))?(r=e.charAt(Ot),Ot++):(r=a,0===Ht&&Tt(at)),r!==a){for(s=[],re.test(e.charAt(Ot))?(n=e.charAt(Ot),Ot++):(n=a,0===Ht&&Tt(ut));n!==a;)s.push(n),re.test(e.charAt(Ot))?(n=e.charAt(Ot),Ot++):(n=a,0===Ht&&Tt(ut));Et=t,t=ht()}else Ot=t,t=a;return It[o]={nextPos:Ot,result:t},t}function dr(){var t,r,s,n,o,u=70*Ot+65,l=It[u];if(l)return Ot=l.nextPos,l.result;if(t=Ot,vr()!==a){for(r=[],s=Ot,58===e.charCodeAt(Ot)?(n=L,Ot++):(n=a,0===Ht&&Tt(rt)),n!==a&&(o=vr())!==a?s=n=[n,o]:(Ot=s,s=a);s!==a;)r.push(s),s=Ot,58===e.charCodeAt(Ot)?(n=L,Ot++):(n=a,0===Ht&&Tt(rt)),n!==a&&(o=vr())!==a?s=n=[n,o]:(Ot=s,s=a);Et=t,t=ht()}else Ot=t,t=a;return It[u]={nextPos:Ot,result:t},t}function yr(){var t,r=70*Ot+66,s=It[r];return s?(Ot=s.nextPos,s.result):("\r\n"===e.substr(Ot,2)?(t="\r\n",Ot+=2):(t=a,0===Ht&&Tt(lt)),t===a&&(se.test(e.charAt(Ot))?(t=e.charAt(Ot),Ot++):(t=a,0===Ht&&Tt(it))),It[r]={nextPos:Ot,result:t},t)}function xr(){var t,r,s=70*Ot+67,n=It[s];return n?(Ot=n.nextPos,n.result):(t=Ot,Ht++,e.length>Ot?(r=e.charAt(Ot),Ot++):(r=a,0===Ht&&Tt(ae)),Ht--,r===a?t=void 0:(Ot=t,t=a),t===a&&(t=yr()),It[s]={nextPos:Ot,result:t},t)}function mr(){var t,r=70*Ot+68,s=It[r];return s?(Ot=s.nextPos,s.result):(ne.test(e.charAt(Ot))?(t=e.charAt(Ot),Ot++):(t=a,0===Ht&&Tt(ct)),It[r]={nextPos:Ot,result:t},t)}function gr(){var t,r=70*Ot+69,s=It[r];return s?(Ot=s.nextPos,s.result):(oe.test(e.charAt(Ot))?(t=e.charAt(Ot),Ot++):(t=a,0===Ht&&Tt(ft)),It[r]={nextPos:Ot,result:t},t)}function br(e){let t=function(e,t){const r=[];for(let s=0;s<e.length;s++)0!=s&&t(e[s-1],e[s])?r[r.length-1].push(e[s]):r.push([e[s]]);return r}(e,((e,t)=>typeof t==typeof e));return t=t.map((e=>"string"==typeof e[0]?[e.join("")]:e)),function(e){return e.reduce(((e,t)=>e.concat(t)),[])}(t)}function Ar(e,t,r){const s={type:e};t.children=r;for(const o of Object.keys(t))void 0!==t[o]&&(s[o]=t[o]);const n=Rt(Et,Ot);return s.loc={start:n.start.offset,end:n.end.offset-1},s}if((r=i())!==a&&Ot===e.length)return r;throw r!==a&&Ot<e.length&&Tt({type:"end"}),s=Dt,n=Nt<e.length?e.charAt(Nt):null,o=Nt<e.length?Rt(Nt,Nt+1):Rt(Nt,Nt),new le(le.buildMessage(s,n),s,n,o)}ae([a],ue.prototype,"exec",1),ae([a],ue.prototype,"execFn",1),ae([a],ue.prototype,"log",1),ae([a],ue.prototype,"collectNs",1),ae([a],ue.prototype,"collectNsMember",1),ae([a],ue.prototype,"_fn",1),ae([a],ue.prototype,"_eval",1),ae([a],ue.prototype,"_run",1),ae([a],ue.prototype,"registerAbortHandler",1),ae([a],ue.prototype,"unregisterAbortHandler",1),ae([a],ue.prototype,"abort",1),ae([a],ue,"collectMetadata",1),function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(le,Error),le.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,s=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){s=e[r].text.split(/\r\n|\n|\r/g);break}var n=this.location.start,o=this.location.source+":"+n.line+":"+n.column;if(s){var a=this.location.end,u=ie("",n.line.toString().length),l=s[n.line-1],i=n.line===a.line?a.column:l.length+1;t+="\n --\x3e "+o+"\n"+u+" |\n"+n.line+" | "+l+"\n"+u+" | "+ie("",n.column-1)+ie("",i-n.column,"^")}else t+="\n at "+o}return t},le.buildMessage=function(e,t){var r,s={literal:function(e){return'"'+o(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?a(e[0])+"-"+a(e[1]):a(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function o(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function u(e){return s[e.type](e)}return"Expected "+function(e){var t,r,s=e.map(u);if(s.sort(),s.length>0){for(t=1,r=1;t<s.length;t++)s[t-1]!==s[t]&&(s[r]=s[t],r++);s.length=r}switch(s.length){case 1:return s[0];case 2:return s[0]+" or "+s[1];default:return s.slice(0,-1).join(", ")+", or "+s[s.length-1]}}(e)+" but "+(((r=t)?'"'+o(r)+'"':"end of input")+" found.")};const fe=["null","yes","no","true","false","each","for","loop","while","break","continue","match","if","elif","else","return"];function pe(e){var t;for(const r of e)switch(r.type){case"def":case"assign":case"ns":if(fe.includes(r.name))throw new ge(`Reserved word "${r.name}" cannot be used as variable name.`);break;case"fn":pe(r.children);break;case"block":pe(r.statements);break;case"if":"block"==r.then.type&&pe(r.then.statements);for(const e of r.elseif)"block"==e.then.type&&pe(e.then.statements);"block"==(null==(t=r.else)?void 0:t.type)&&pe(r.else.statements)}return e}function he(e){const t=[],r=[];for(const s of e)if("attr"==s.type)r.push(s);else if("def"==s.type)s.attr.push(...r),r.splice(0,r.length),"fn"==s.expr.type&&(s.expr.children=he(s.expr.children)),t.push(s);else{if(r.length>0)throw new ge("invalid attribute.");switch(s.type){case"fn":s.children=he(s.children);break;case"block":s.statements=he(s.statements)}t.push(s)}if(r.length>0)throw new ge("invalid attribute.");return t}class ve{constructor(){this.plugins=[pe,he]}static parse(e){return null==ve.instance&&(ve.instance=new ve),ve.instance.parse(e)}addPlugin(e){this.plugins.push(e)}parse(e){let t;try{t=ce(e)}catch(r){if(r.location)throw new me(`Line ${r.location.start.line}:${r.location.start.column}`);throw r}for(const s of this.plugins)t=s(t);return t}}const de={def:0,assign:1,call:2,return:3,if:4,for:5,forOf:6,var:7,null:8,bool:9,num:10,str:11,arr:12,fn:13,obj:14,prop:15,propCall:16,index:17,block:18,tmpl:19,ns:20,match:21,meta:22,propAssign:23,indexAssign:24,inc:25,dec:26,attr:27,break:28,loop:29,continue:30,infix:31,operator:32};function ye(e){if(null==e)return null;switch(e.type){case"def":return[de[e.type],e.name,e.mut,ye(e.expr),xe(e.attr)];case"assign":return[de[e.type],e.name,ye(e.expr)];case"call":return[de[e.type],e.name,xe(e.args)];case"return":return[de[e.type],ye(e.expr)];case"if":return[de[e.type],ye(e.cond),ye(e.then),e.elseif.map((e=>[ye(e.cond),ye(e.then)])),ye(e.else)];case"for":return[de[e.type],e.var,ye(e.from),ye(e.to),ye(e.times),ye(e.for)];case"forOf":return[de[e.type],e.var,ye(e.items),ye(e.for)];case"var":return[de[e.type],e.name];case"null":return[de[e.type]];case"bool":case"num":case"str":return[de[e.type],e.value];case"arr":return[de[e.type],xe(e.value)];case"fn":return[de[e.type],e.args,xe(e.children)];case"obj":return[de[e.type],Array.from(e.value.entries()).map((e=>[e[0],ye(e[1])]))];case"prop":return[de[e.type],e.obj,e.path];case"propCall":return[de[e.type],e.obj,e.path,xe(e.args)];case"index":return[de[e.type],e.arr,ye(e.i)];case"block":return[de[e.type],xe(e.statements)];case"tmpl":return[de[e.type],e.tmpl.map((e=>"string"==typeof e?e:ye(e)))];case"ns":return[de[e.type],e.name,xe(e.members)];case"match":return[de[e.type],ye(e.about),e.qs.map((e=>[ye(e.q),ye(e.a)])),ye(e.default)];case"meta":return[de[e.type],e.name,ye(e.value)];case"propAssign":return[de[e.type],e.obj,e.path,ye(e.expr)];case"indexAssign":return[de[e.type],e.arr,ye(e.i),ye(e.expr)];case"inc":case"dec":return[de[e.type],e.name,ye(e.expr)];case"attr":return[de[e.type],e.name,ye(e.value)];case"break":return[de[e.type],null];case"loop":return[de[e.type],xe(e.statements)];case"continue":return[de[e.type],null];case"infix":return[de[e.type],xe(e.operands),xe(e.operators)];case"operator":return[de[e.type],e.op]}}function xe(e){return e.map((e=>ye(e)))}class me extends Error{constructor(e){let t="Syntax error.";e&&(t+=` ${e}`),super(t)}}class ge extends Error{constructor(e){let t="Semantic error.";e&&(t+=` ${e}`),super(t)}}const be={id:"root"},Ae=x("h1",null,"AiScript (v0.11.1) Playground",-1),Pe={id:"grid1"},Ce={id:"editor",class:"container"},we=C("Input"),ke={key:0,class:"syntaxError"},_e={id:"logs",class:"container"},Se=x("header",null,"Output",-1),je={class:"type"},Me={id:"grid2"},Oe={id:"ast",class:"container"},Ee=x("header",null,"AST",-1),$e={id:"bin",class:"container"},Ne=x("header",null,"Bytecode",-1),De=x("div",{id:"debugger",class:"container"},[x("header",null,"Debugger"),x("div")],-1);_({setup(e){const t=h(window.localStorage.getItem("script")||'<: "Hello, AiScript!"'),r=h(null),s=h(null),n=h([]),o=h(!1);v(t,(()=>{window.localStorage.setItem("script",t.value);try{r.value=ve.parse(t.value),o.value=!1}catch(e){return o.value=!0,void console.error(e)}s.value=xe(r.value)}),{immediate:!0});const a=()=>{t.value='for (#i, 100) {\n  <: if ((i % 15) = 0) "FizzBuzz"\n    elif ((i % 3) = 0) "Fizz"\n    elif ((i % 5) = 0) "Buzz"\n    else i\n}'},u=async()=>{n.value=[];const e=new ue({},{in:e=>new Promise((t=>{t(window.prompt(e))})),out:e=>{n.value.push({id:Math.random(),type:e.type,text:"str"===e.type||"num"===e.type?e.value:G(e),print:!0})},log:(e,t)=>{switch(e){case"end":n.value.push({id:Math.random(),text:G(t.val,!0),print:!1})}}});try{await e.exec(r.value)}catch(t){console.error(t),window.alert("Error: "+t)}},l=e=>w.exports.highlight(e,w.exports.languages.js,"javascript");return(e,i)=>(d(),y("div",be,[Ae,x("div",Pe,[x("div",Ce,[x("header",null,[we,x("div",{class:"actions"},[x("button",{onClick:a},"FizzBuzz")])]),x("div",null,[x(m(k),{class:"code",modelValue:t.value,"onUpdate:modelValue":i[1]||(i[1]=e=>t.value=e),highlight:l,"line-numbers":!1},null,8,["modelValue"])]),x("footer",null,[o.value?(d(),y("span",ke,"Syntax Error!")):g("",!0),x("div",{class:"actions"},[x("button",{onClick:u},"RUN")])])]),x("div",_e,[Se,x("div",null,[(d(!0),y(b,null,A(n.value,(e=>(d(),y("div",{class:["log",[{print:e.print},e.type]],key:e.id},[x("span",je,P(e.type),1),C(" "+P(e.text),1)],2)))),128))])])]),x("div",Me,[x("div",Oe,[Ee,x("div",null,[x("pre",null,P(JSON.stringify(r.value,null,"\t")),1)])]),x("div",$e,[Ne,x("div",null,[x("code",null,P(JSON.stringify(s.value)),1)])]),De])]))}}).mount("#app");
